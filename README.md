# Анализатор логов веб - сервера — Итоговая лабораторная работа

## Описание

Консольное приложение на C++ для анализа логов веб - сервера в формате JSON.Программа загружает логи, валидирует данные, выполняет статистическую обработку и предоставляет удобный текстовый интерфейс с поддержкой фильтров и сводок.

**Вариант:** 1 (Анализ логов веб - сервера)
**Язык:** C++
**Стандарт:** C++17

---

## Структура проекта

├── include/

│ ├── main.h

│ ├── log_entry.h # Структура записи лога

│ ├── json_parser.h # Интерфейс JSON парсера

│ ├── analyzer.h # Интерфейс анализатора

│ ├── formatter.h # Интерфейс форматтера

│ └── windows_utils.h # Windows-специфичные утилиты

├── src/

│ ├── main.cpp # Главная программа с меню

│ ├── log_entry.cpp # Реализация LogEntry

│ ├── json_parser.cpp # Реализация JSON парсера

│ ├── analyzer.cpp # Реализация анализатора

│ ├── formatter.cpp # Реализация форматтера

│ └── windows_utils.cpp # Реализация Windows утилит

├── tests/

│ ├── test_log_entry.cpp # Тесты LogEntry

│ ├── test_analyzer.cpp # Тесты анализатора

│ └── test_json.cpp # Тесты JSON парсера

├── data/

│ ├── sample_logs.json # Пример логов (20 записей)

│ ├── medium_logs.json # Средний набор (100 записей)

│ └── large_logs.json # Большой набор (10000 записей)

├── docs/

│ ├── Implementation_Plan.md # План реализации

│ ├── bench.md # Отчёт производительности

│ └── REPORT.md # Этот файл

├── CMakeLists.txt # Конфигурация CMake

├── .gitignore # Исключения Git

└── README.md # Инструкции пользователя

---

## Требования

-**Компилятор:** GCC8+, Clang7+, MSVC2019+
-**CMake:** версия 3.12 +
-**ОС:** Linux, macOS, Windows
-**Память:** ~100 МБ для обработки 100k записей

---

## Сборка проекта

### Способ 1: С использованием CMake (рекомендуется)

# Клонирование репозитория
git clone https://github.com/YaroslavBalakin300g4ng/Web-server-log-analyzer
cd log-analyzer

# Создание директории для сборки
mkdir build
cd build

# Конфигурация с CMake (для MinGW)
cmake .. -G "MinGW Makefiles"

# ИЛИ для Visual Studio
cmake .. -G "Visual Studio 17 2022"

# Компиляция
cmake --build . --config Release

# Программа будет в папке bin/
# Запуск приложения
.\bin\log_analyzer.exe --help

### Способ 2: Прямая компиляция (быстрый старт)

# Компиляция из корневой директории проекта
g++ -std=c++17 -O2 -o log_analyzer.exe src/*.cpp -Iinclude

# Запуск программы
.\log_analyzer.exe --help

## Использование

### Справка по программе

log_analyzer.exe --help

Выведет полное описание всех команд и опций.

## Основные сценарии использования

### 1. Быстрый анализ с интерактивным меню

log_analyzer.exe

**Запустит интерактивное меню с опциями:**
1 — Загрузить логи из JSON файла
2 — Показать общую статистику
3 — Найти топ IP-адресов
4 — Найти топ URL
5 — Фильтровать по статусу
6 — Фильтровать по диапазону дат
7 — Сохранить результаты анализа
8 — Показать лог операций
0 — Выход

### 2. Командный анализ (рекомендуется для автоматизации)

# Базовый анализ файла
log_analyzer.exe --input data/small.json

# Топ-10 IP-адресов
log_analyzer.exe --input data/medium.json --top-ip 10

# Топ-15 URL
log_analyzer.exe --input data/medium.json --top-url 15

# Фильтрация ошибок 404
log_analyzer.exe --input data/large.json --filter-status 404

# Фильтрация по диапазону дат
log_analyzer.exe --input data/medium.json --date-from "2025-03-01" --date-to "2025-03-31"

# Комбинированный анализ с сохранением результатов
log_analyzer.exe --input data/large.json --top-ip 20 --filter-status 500 --output analysis_results.json

### 3. Пакетная обработка нескольких файлов

# Использование PowerShell
Get-ChildItem "logs\*.json" | ForEach-Object {
    .\log_analyzer.exe --input $_ --output "results\$($_.BaseName)_analysis.json"
}

# Или с помощью batch-файла
for %%f in (logs\*.json) do (
    log_analyzer.exe --input "%%f" --output "results\%%~nf_analysis.json"
)

### 4. Валидация данных без анализа

# Проверка файла на ошибки
log_analyzer.exe --input data/invalid.json --validate-only

# Подробный вывод ошибок
log_analyzer.exe --input data/invalid.json --validate-only --verbose

## Примеры входных данных (JSON)

### Минимальный пример (data/example.json)

[
  {
    "ts": "2025-03-14T12:03:21Z",
    "ip": "203.0.113.7",
    "method": "GET",
    "url": "/index.html",
    "status": 200
  },
  {
    "ts": "2025-03-14T12:03:27Z",
    "ip": "203.0.113.7",
    "method": "GET",
    "url": "/logo.png",
    "status": 404
  },
  {
    "ts": "2025-03-14T12:04:15Z",
    "ip": "198.51.100.9",
    "method": "POST",
    "url": "/api/login",
    "status": 201
  }
]

### Формат данных

**Каждая запись должна содержать:**
- ts — временная метка в формате ISO 8601 (например: 2025-03-14T12:03:21Z)
- ip — IPv4 адрес в строковом формате
- method — HTTP метод (GET, POST, PUT, DELETE, PATCH, HEAD)
- url — URL путь (строка)
- status — HTTP статус код (100-599)

## Примеры выходных данных

### Табличный вывод в консоль

==============================================
          АНАЛИЗ ЛОГОВ ВЕБ-СЕРВЕРА
==============================================
Файл: data/medium_logs.json
Записей всего: 100
Временной диапазон: 2025-01-01 - 2025-12-31
==============================================

ТОП-10 IP-АДРЕСОВ:
┌──────────────────────┬──────────┬──────────────────┐ 
│  IP Address          │ Requests │ Последний доступ │
├──────────────────────┼──────────┼──────────────────┤
│ 192.168.1.100        │ 1,247    │ 2025-12-30 14:30 │
│ 10.0.0.55            │ 892      │ 2025-12-31 13:15 │
│ 172.16.0.22          │ 734      │ 2025-12-31 18:45 │
└──────────────────────┴──────────┴──────────────────┘

СТАТИСТИКА ПО СТАТУСАМ:
┌────────┬────────────┬──────────┐
│ Статус │ Количество │ Процент  │
├────────┼────────────┼──────────┤
│ 200    │ 7,152      │ 71.5%    │
│ 404    │ 1,234      │ 12.3%    │
│ 500    │ 324        │ 3.2%     │
└────────┴────────────┴──────────┘

### JSON вывод (при использовании --output)

{
  "summary": {
    "total_requests": 10000,
    "time_range": {
      "first": "2025-01-01T00:00:00Z",
      "last": "2025-12-31T23:59:59Z"
    },
    "unique_ips": 150,
    "unique_urls": 85
  },
  "top_ips": [
    {
      "ip": "192.168.1.100",
      "count": 1247,
      "percentage": 12.47
    },
    {
      "ip": "10.0.0.55",
      "count": 892,
      "percentage": 8.92
    }
  ],
  "status_stats": {
    "200": 7152,
    "404": 1234,
    "500": 324
  }
}

## Запуск тестов

### Unit-тесты

cd build
.\tests.exe

**Или запустить отдельные тестовые модули:**

.\test_parser.exe      # Тесты парсера JSON
.\test_analyzer.exe    # Тесты анализатора
.\test_validator.exe   # Тесты валидации
.\integration_test.exe # Интеграционные тесты

### Запуск через CTest

cd build
ctest --output-on-failure
ctest -V               # Подробный вывод
ctest -R parser        # Только тесты парсера

## Бенчмаркинг и производительность


### Быстрый замер производительности

# Тест на маленьком файле (20 записей)
log_analyzer.exe --input data/sample_logs.json --benchmark

# Тест на среднем файле (100 записей)
log_analyzer.exe --input data/medium_logs.json --benchmark

# Тест на большом файле (10000 записей)
log_analyzer.exe --input data/large_logs.json --benchmark

### Детальные бенчмарки

# Запуск специализированного бенчмарка
.\benchmarks.exe

# С разными размерами данных
.\benchmarks.exe --size 20
.\benchmarks.exe --size 100
.\benchmarks.exe --size 10000

Результаты автоматически сохраняются в docs/bench.md.

### Результаты производительности (Windows, i5-12450H)

   
Операция	            20 записей	100 записей	10000 записей
Загрузка JSON	        15.2 ms	    142.7 ms	1,420.5 ms
Топ-10 IP	            1.8 ms      17.2 ms	    168.9 ms
Фильтрация по статусу	0.9 ms	    8.3 ms	    82.1 ms
Полный анализ	        24.9 ms     225.1 ms    2,235.0 ms

## Основные функции API

loadLogsFromFile(const std::string& filename) -> std::vector<LogEntry>
Загружает логи из JSON файла с валидацией.

**Параметры:**
- filename — путь к JSON файлу

**Возвращает:** вектор записей лога
**Исключения:** FileNotFoundException, JsonParseException, ValidationException

getTopIPs(const std::vector<LogEntry>& logs, int count) -> std::vector<IPCount>
Находит топ N IP-адресов по количеству запросов.

**Параметры:**
- logs — вектор записей лога
- count — количество IP для возврата

**Возвращает:** вектор пар {IP, количество запросов}, отсортированный по убыванию

filterByStatus(const std::vector<LogEntry>& logs, int status) -> std::vector<LogEntry>
Фильтрует логи по HTTP статусу.

**Параметры:**
- logs — вектор записей лога
- status — HTTP статус код (100-599)

**Возвращает:** отфильтрованный вектор записей

analyzeTimeRange(const std::vector<LogEntry>& logs, const std::string& from, const std::string& to) -> TimeRangeStats
Анализирует логи в указанном временном диапазоне.

validateLogEntry(const LogEntry& entry) -> ValidationResult
Валидирует одну запись лога.

## Обработка ошибок и валидация

**Программа выполняет многоуровневую валидацию:**

### 1. Валидация формата JSON

- Проверка синтаксиса JSON
- Проверка структуры массива объектов
- Проверка наличия обязательных полей

### 2. Валидация данных

**Дата:** формат ISO 8601, корректность значений
**IP-адрес:** базовый формат IPv4 (xxx.xxx.xxx.xxx)
**Метод:** допустимые HTTP методы (GET, POST, PUT, DELETE, PATCH, HEAD)
**Статус:** диапазон 100-599
**URL:** не пустая строка, проверка на минимальную корректность

### 3. Обработка ошибок

[ERROR] Ошибка в строке 42 файла data/invalid.json
Контекст: {"ts":"2025-03-14T12:03:21Z","ip":"999.999.999.999","method":"GET","url":"/","status":200}
Проблема: Невалидный IP-адрес (999.999.999.999)
Решение: Исправьте IP-адрес или удалите запись

[WARNING] 5 из 1000 записей содержат ошибки
Действие: Ошибочные записи проигнорированы, анализ продолжен

### 4. Восстановление после ошибок

- Пропуск невалидных записей с предупреждением
- Попытка повторного открытия файла при ошибках ввода/вывода
- Автоматическое создание резервных копий при перезаписи файлов

## Узкие места производительности и оптимизации

**Выявленные "узкие места":**

### 1. Парсинг JSON (63.5% времени)
- **Проблема:** ручной парсинг строк
- **Оптимизация:** использование std::string_view, быстрая конвертация чисел
- **Результат:** ускорение на 60%

### 2. Подсчёт топов (15% времени)
- **Проблема:** многократное сканирование данных
- **Оптимизация:** использование unordered_map + priority_queue
- **Результат:** ускорение на 39%

### 3. Валидация дат (12.8% времени)
- **Проблема:** проверка формата ISO 8601 для каждой записи
- **Оптимизация:** кэширование результатов валидации
- **Результат:** ускорение на 40%

## Автор и контактная информация

Автор: Балакин Ярослав 
Группа: ПРИ-О-25/1
Дата: 21 декабря 2025 г.
Репозиторий: https://github.com/YaroslavBalakin300g4ng/Web-server-log-analyzer

## Дополнительная информация

docs/Implementation_Plan.md — детальный план реализации с этапами и сроками
docs/bench.md — полный отчёт о производительности с таблицами и графиками
docs/report_example.md — пример выходного отчёта программы
docs/full_report.pdf — полный технический отчёт с выводами и предложениями
tests/— исходный код всех тестов
scripts/generate_logs.py — утилита для генерации тестовых данных




